{% load static %}

<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>{{ username }}さんの投稿一覧|遊ViVA in KYOTO</title>
        <link rel="stylesheet" href="{% static 'asovi_app/css/style.css' %}">
        <style>
            html, body {
              height: 100%;
              margin: 0;
              padding: 0;
            }
            #map {
              height: 80%;
              width: 80%;
            }
        </style>
    </head>
    <body>
        <!-- {% for post in posts %}
            {% if post.image %}
            <img src="{{ post.image.url }}"/>
            {% endif %}
            {{ post.body|linebreaksbr }} -->
            <!--for test-->
            <!-- {{ post.latitude }}
            {{ post.longitude }}
        {% endfor %} -->
        {{ post.posted_by }}
        {{ post.body }}
        <div id="map"></div>
        <script>
            var map;
            var markers = [];
            var infoWindows = [];
            var posts = JSON.parse('{{ posts_json|escapejs }}');
            console.log(posts);
            var center = {
                lat: 35,
                lng: 136
            };
            function initMap(){
                map = new google.maps.Map(document.getElementById('map'),{
                    center: center,
                    zoom: 13
                });
                for( var post of posts ){
                    //console.log(post.fields.latitude)
                    markers.push(new google.maps.Marker({
                        position: {
                            lat: post.fields.latitude,
                            lng: post.fields.longitude
                        },
                        map: map
                    }));
                    infoWindows.push(new google.maps.InfoWindow({
                        content : "<div id='content'>" + post.fields.genre + "<br><img src=\"../" + post.fields.image + "\" width=\"200\"/><br>" + post.fields.body + "<div>"
                    }));
                    // marker.addListener('click', function() { // マーカーをクリックしたとき
                    //     infoWindow.open(map, marker); // 吹き出しの表示
                    // });
                }
                console.log(markers)
                let num = markers.length
                for(let i=0; i<num; i++){
                    markers[i].addListener('click', function(){
                        infoWindows[i].open(map,markers[i]);
                    });
                }
            }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap" async defer></script>
    </body>
</html>
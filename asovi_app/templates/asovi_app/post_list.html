{% load static %}


<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
    <title>マイページ|遊ViVA in KYOTO</title>
    <link rel="stylesheet" href="{% static 'asovi_app/css/post_list.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes">
        <style>
            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #map {
                height: 80%;
                width: 80%;
            }
        </style>
        <script>
            var myLat;
            var myLng;
            if ( !navigator.geolocation) {
                window.alert('この端末では位置情報を取得できません');
            } else {
                
                navigator.geolocation.getCurrentPosition(success, error);

                function success(position){
                    myLat = position.coords.latitude;
                    myLng = position.coords.longitude;
                }

                function error(position){
                    var errorMessage = {
                        0:"原因不明のエラーが発生しました。",
                        1: "位置情報取得が許可されませんでした。",
                        2: "位置情報が取得できませんでした。",
                        3: "タイムアウトしました。",
                    };
                    window.alert(errorMessage[error.code]);
                    myLat=35;
                    myLng=136;
                }
            }
        </script>
    </head>

    <body>
        <!-- ここから -->
        <div class="logo">
            <p><strong>マイページ</strong></p> 
        </div>     
        <!-- ここまで共通 -->

         <!-- アイコン画像 -->
        <!-- profile_editで設定したアイコンが表示されるように編集して下さい -->
        {% if icon %}
        <img src="/{{icon}}" alt="アイコン画像" id="sampleimg">
        {% else %}
        <img src="{% static 'asovi_app/img/cameraicon.png'%}" alt="" id="sampleimg">
        {% endif %}
        <!-- ここまでアイコン -->

        <!-- ここから登録情報 -->
        <!-- 設定したものが反映されるように編集して下さい -->
        <!-- クラス名は変更しないでください -->
        <div class="line">
            <div class="line1">
                <!-- ユーザーID -->
                <p class="userid">@aaaaaa</p>
                <!-- 投稿数 -->
                <p class="many">12</p>
                <!-- 友達数  -->
                <p class="friend">99</p>
        </div>
            <div class="line2">   
                <!-- ユーザー名 -->
                <p class="username">京大たろう</p>
                <p class="toukou">投稿</p>
                <p class="tomo">友達</p>
            </div>
        </div>
        <!-- ここまで登録情報 -->

        <br>
        <div class="button">
            <div class="edit">
                <a href="{% url 'asovi_app:profile_edit' %}">編集</a>     
            </div>
            <div class="logout">
                <a href="{% url 'account_logout' %}">ログアウト</a>
            </div>
        </div>
        <a href="{% url 'asovi_app:check_event' %}" class="notice">{{ notification }}件のイベント</a>
                                                                        <!-- ↑が取得されるようにして下さい -->

        <div id="map"></div>
        <br>

        <!-- 投稿一覧 -->

        <p class="post">投稿一覧</p>
        {% for post in post_list %}
           <a href="{% url 'asovi_app:post_detail' post.pk %}"><img src="/{{post.image}}" alt="" width="117" height="117"></a> 
            <!-- {{post.posted_by}}
            {{post.time}}
            {{post.body}} -->
            <br>
        {% endfor %}
        <!-- {% if user.pk == me.pk %}
            <a href="{% url 'asovi_app:profile_edit' %}">プロフィール編集</a>
            <a href="{% url 'asovi_app:signout' %}">サインアウト</a>

        {% else %}
            <form action="{% url 'asovi_app:friend_request' user.pk %}" method="POST">
                {% csrf_token %}
                <button type="submit">友達申請</button>
            </form>
        {% endif %} -->

    </body>
    <script>
        var map;
        var markers = [];
        var infoWindows = [];
        var post_list = JSON.parse('{{ post_list_json|escapejs }}');

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {
                    lat: myLat,
                    lng: myLng,
                },
                zoom: 13
            });

            for (var post of post_list){
                var postLat = post.fields.latitude;
                var postLng = post.fields.longitude;
                markers.push(new google.maps.Marker({
                    position: {
                        lat: postLat,
                        lng: postLng,
                    },
                    map: map
                }));

                infoWindows.push(new google.maps.InfoWindow({
                    content: '<div class="content">' + '<img src=\"/' + post.fields.image + '\"  width=\"30\">' + '<h2>' + post.fields.body + '</h2>' + '</div>'
                }));

            }

            let num = markers.length
            for (let i = 0; i < num; i++){
                markers[i].addListener('click', function(){
                    infoWindows[i].open(map, markers[i]);
                });
            }

        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap" async defer></script>
</html>

